<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8.2 Convergence Behavior | Mobile Network Operator Data for Spatial Statistics - Eurostat Coding Labs 2020</title>
  <meta name="description" content="A showcase of our remote collaborative efforts from working on the MNO project" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="8.2 Convergence Behavior | Mobile Network Operator Data for Spatial Statistics - Eurostat Coding Labs 2020" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A showcase of our remote collaborative efforts from working on the MNO project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8.2 Convergence Behavior | Mobile Network Operator Data for Spatial Statistics - Eurostat Coding Labs 2020" />
  
  <meta name="twitter:description" content="A showcase of our remote collaborative efforts from working on the MNO project" />
  

<meta name="author" content="Giulia Regazzoni, Marco Ramljak, Stefania Scrofani, Tony Hung" />


<meta name="date" content="2021-02-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="discrepancy-measures-per-iteration-1.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Cover</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="executive-summary.html"><a href="executive-summary.html"><i class="fa fa-check"></i><b>3</b> Executive Summary</a><ul>
<li class="chapter" data-level="3.0.1" data-path="executive-summary.html"><a href="executive-summary.html#preface"><i class="fa fa-check"></i><b>3.0.1</b> Preface</a></li>
<li class="chapter" data-level="3.0.2" data-path="executive-summary.html"><a href="executive-summary.html#toy-world-generation"><i class="fa fa-check"></i><b>3.0.2</b> Toy World Generation</a></li>
<li class="chapter" data-level="3.0.3" data-path="executive-summary.html"><a href="executive-summary.html#estimation-strategies"><i class="fa fa-check"></i><b>3.0.3</b> Estimation strategies</a></li>
<li class="chapter" data-level="3.0.4" data-path="executive-summary.html"><a href="executive-summary.html#evaluation-of-all-estimates"><i class="fa fa-check"></i><b>3.0.4</b> Evaluation of all estimates</a></li>
<li class="chapter" data-level="3.0.5" data-path="executive-summary.html"><a href="executive-summary.html#excurse-evaluation-looking-deeper-into-the-convergence-behavior"><i class="fa fa-check"></i><b>3.0.5</b> Excurse Evaluation: Looking deeper into the convergence behavior</a></li>
<li class="chapter" data-level="3.0.6" data-path="executive-summary.html"><a href="executive-summary.html#final-remarks"><i class="fa fa-check"></i><b>3.0.6</b> Final Remarks</a></li>
<li class="chapter" data-level="3.0.7" data-path="executive-summary.html"><a href="executive-summary.html#references"><i class="fa fa-check"></i><b>3.0.7</b> References</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="making-a-toy-world.html"><a href="making-a-toy-world.html"><i class="fa fa-check"></i><b>4</b> Making a Toy World</a><ul>
<li class="chapter" data-level="4.1" data-path="prerequisites.html"><a href="prerequisites.html"><i class="fa fa-check"></i><b>4.1</b> Prerequisites</a></li>
<li class="chapter" data-level="4.2" data-path="generation-of-mobile-phone-population.html"><a href="generation-of-mobile-phone-population.html"><i class="fa fa-check"></i><b>4.2</b> Generation of Mobile Phone Population</a></li>
<li class="chapter" data-level="4.3" data-path="generation-of-a-synthetic-radio-network-1.html"><a href="generation-of-a-synthetic-radio-network-1.html"><i class="fa fa-check"></i><b>4.3</b> Generation of a synthetic Radio Network</a></li>
<li class="chapter" data-level="4.4" data-path="device-to-cell-association-1.html"><a href="device-to-cell-association-1.html"><i class="fa fa-check"></i><b>4.4</b> Device to cell association</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="estimation-strategies-1.html"><a href="estimation-strategies-1.html"><i class="fa fa-check"></i><b>5</b> Estimation Strategies</a></li>
<li class="chapter" data-level="6" data-path="evaluation-methods.html"><a href="evaluation-methods.html"><i class="fa fa-check"></i><b>6</b> Evaluation Methods</a><ul>
<li class="chapter" data-level="6.1" data-path="evaluation-of-all-estimates-1.html"><a href="evaluation-of-all-estimates-1.html"><i class="fa fa-check"></i><b>6.1</b> Evaluation of all estimates</a><ul>
<li class="chapter" data-level="6.1.1" data-path="evaluation-of-all-estimates-1.html"><a href="evaluation-of-all-estimates-1.html#geographical-evaluation-1"><i class="fa fa-check"></i><b>6.1.1</b> Geographical Evaluation</a></li>
<li class="chapter" data-level="6.1.2" data-path="evaluation-of-all-estimates-1.html"><a href="evaluation-of-all-estimates-1.html#statisticaldistributional-evaluation-1"><i class="fa fa-check"></i><b>6.1.2</b> Statistical/Distributional Evaluation</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="kantorovich-wasserstein-distance-kwd.html"><a href="kantorovich-wasserstein-distance-kwd.html"><i class="fa fa-check"></i><b>6.2</b> Kantorovich-Wasserstein Distance (KWD)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="a-final-note.html"><a href="a-final-note.html"><i class="fa fa-check"></i><b>7</b> A Final Note</a></li>
<li class="chapter" data-level="8" data-path="appendix-a-a-deep-dive-into-the-convergence-behaviour-of-mle-estimates.html"><a href="appendix-a-a-deep-dive-into-the-convergence-behaviour-of-mle-estimates.html"><i class="fa fa-check"></i><b>8</b> Appendix A: A deep dive into the convergence behaviour of MLE estimates</a><ul>
<li class="chapter" data-level="8.1" data-path="discrepancy-measures-per-iteration-1.html"><a href="discrepancy-measures-per-iteration-1.html"><i class="fa fa-check"></i><b>8.1</b> Discrepancy measures per iteration</a></li>
<li class="chapter" data-level="8.2" data-path="convergence-behavior-1.html"><a href="convergence-behavior-1.html"><i class="fa fa-check"></i><b>8.2</b> Convergence Behavior</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mobile Network Operator Data for Spatial Statistics - Eurostat Coding Labs 2020</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="convergence-behavior-1" class="section level2">
<h2><span class="header-section-number">8.2</span> Convergence Behavior</h2>
<p>In this part, we will look at the convergence behavior over time through the actual numbers of estimated population and the residual. The residual is calculated as the <em>true population minus the estimated population</em>. The residual plot only contain certain number of iterations.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="convergence-behavior-1.html#cb3-1"></a>esample &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;~/Desktop/Eurostat/est.equal.1000iter.sample.rds&quot;</span>) <span class="co"># Load in the data</span></span>
<span id="cb3-2"><a href="convergence-behavior-1.html#cb3-2"></a>esample<span class="op">$</span>internal.id =<span class="st"> </span><span class="kw">as.factor</span>(esample<span class="op">$</span>internal.id) <span class="co"># recast the `internal id` as a factor</span></span>
<span id="cb3-3"><a href="convergence-behavior-1.html#cb3-3"></a>esample =<span class="st"> </span>esample <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(u.true.y)) <span class="co"># take out u.true.y</span></span>
<span id="cb3-4"><a href="convergence-behavior-1.html#cb3-4"></a>esample =<span class="st"> </span>esample <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(pop.area.kind.helper,u.true)) <span class="co"># take out other columns</span></span>
<span id="cb3-5"><a href="convergence-behavior-1.html#cb3-5"></a><span class="kw">length</span>(<span class="kw">colnames</span>(esample)[<span class="dv">406</span><span class="op">:</span><span class="dv">1007</span>]) <span class="co"># checking the length of the column names</span></span>
<span id="cb3-6"><a href="convergence-behavior-1.html#cb3-6"></a><span class="co"># Generate the column names through the use of for loops</span></span>
<span id="cb3-7"><a href="convergence-behavior-1.html#cb3-7"></a><span class="co"># It&#39;s important to put 0 in front or else ggplot will then graph 1000 in front of 100, for example.</span></span>
<span id="cb3-8"><a href="convergence-behavior-1.html#cb3-8"></a>iters =<span class="st"> </span><span class="kw">c</span>() </span>
<span id="cb3-9"><a href="convergence-behavior-1.html#cb3-9"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>) {</span>
<span id="cb3-10"><a href="convergence-behavior-1.html#cb3-10"></a>  iters =<span class="st"> </span><span class="kw">c</span>(iters, <span class="kw">paste</span>(<span class="st">&quot;000&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-11"><a href="convergence-behavior-1.html#cb3-11"></a>}</span>
<span id="cb3-12"><a href="convergence-behavior-1.html#cb3-12"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">10</span><span class="op">:</span><span class="dv">99</span>) {</span>
<span id="cb3-13"><a href="convergence-behavior-1.html#cb3-13"></a>  iters =<span class="st"> </span><span class="kw">c</span>(iters, <span class="kw">paste</span>(<span class="st">&quot;00&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-14"><a href="convergence-behavior-1.html#cb3-14"></a>}</span>
<span id="cb3-15"><a href="convergence-behavior-1.html#cb3-15"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">100</span><span class="op">:</span><span class="dv">400</span>) {</span>
<span id="cb3-16"><a href="convergence-behavior-1.html#cb3-16"></a>  iters =<span class="st"> </span><span class="kw">c</span>(iters, <span class="kw">paste</span>(<span class="st">&quot;0&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-17"><a href="convergence-behavior-1.html#cb3-17"></a>}</span>
<span id="cb3-18"><a href="convergence-behavior-1.html#cb3-18"></a><span class="kw">colnames</span>(esample)[<span class="dv">2</span><span class="op">:</span><span class="dv">402</span>] =<span class="st"> </span>iters</span>
<span id="cb3-19"><a href="convergence-behavior-1.html#cb3-19"></a>iters2 =<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb3-20"><a href="convergence-behavior-1.html#cb3-20"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">401</span><span class="op">:</span><span class="dv">999</span>) {</span>
<span id="cb3-21"><a href="convergence-behavior-1.html#cb3-21"></a>  iters2 =<span class="st"> </span><span class="kw">c</span>(iters2, <span class="kw">paste</span>(<span class="st">&quot;0&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-22"><a href="convergence-behavior-1.html#cb3-22"></a>}</span>
<span id="cb3-23"><a href="convergence-behavior-1.html#cb3-23"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1000</span><span class="op">:</span><span class="dv">1002</span>){</span>
<span id="cb3-24"><a href="convergence-behavior-1.html#cb3-24"></a>  iters2 =<span class="st"> </span><span class="kw">c</span>(iters2, <span class="kw">paste</span>(<span class="st">&quot;&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-25"><a href="convergence-behavior-1.html#cb3-25"></a>}</span>
<span id="cb3-26"><a href="convergence-behavior-1.html#cb3-26"></a><span class="kw">colnames</span>(esample)[<span class="dv">406</span><span class="op">:</span><span class="dv">1007</span>] =<span class="st"> </span>iters2</span>
<span id="cb3-27"><a href="convergence-behavior-1.html#cb3-27"></a>equal =<span class="st"> </span>esample <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># transform the data frame into long form</span></span>
<span id="cb3-28"><a href="convergence-behavior-1.html#cb3-28"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(pop)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-29"><a href="convergence-behavior-1.html#cb3-29"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(internal.id, pop.area.kind,u.true.x), <span class="dt">names_to =</span> <span class="st">&quot;iter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;sim&quot;</span>)</span>
<span id="cb3-30"><a href="convergence-behavior-1.html#cb3-30"></a>equal<span class="op">$</span>iter =<span class="st"> </span><span class="kw">as.numeric</span>(equal<span class="op">$</span>iter) <span class="co"># cast the `iter` variable as a numeric variable</span></span>
<span id="cb3-31"><a href="convergence-behavior-1.html#cb3-31"></a><span class="co"># Plot of Estimated Population over Iterations</span></span>
<span id="cb3-32"><a href="convergence-behavior-1.html#cb3-32"></a>equal.plot =<span class="st"> </span>equal <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-33"><a href="convergence-behavior-1.html#cb3-33"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> iter, <span class="dt">y =</span> sim, <span class="dt">group =</span> internal.id)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-34"><a href="convergence-behavior-1.html#cb3-34"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> pop.area.kind)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-35"><a href="convergence-behavior-1.html#cb3-35"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of Iteration&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Estimated Population&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Equal Probability Matrix&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-36"><a href="convergence-behavior-1.html#cb3-36"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-37"><a href="convergence-behavior-1.html#cb3-37"></a><span class="st">  </span><span class="kw">scale_color_ptol</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;Suburban&quot;</span>, <span class="st">&quot;Urban&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-38"><a href="convergence-behavior-1.html#cb3-38"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(pop.area.kind),<span class="dt">scales=</span><span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb3-39"><a href="convergence-behavior-1.html#cb3-39"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">50</span>))</span>
<span id="cb3-40"><a href="convergence-behavior-1.html#cb3-40"></a><span class="kw">saveRDS</span>(equal.plot, <span class="dt">file =</span> <span class="st">&quot;equal.plot.rds&quot;</span>) <span class="co"># save the plot as RDS</span></span>
<span id="cb3-41"><a href="convergence-behavior-1.html#cb3-41"></a><span class="co"># Residual Plot</span></span>
<span id="cb3-42"><a href="convergence-behavior-1.html#cb3-42"></a>esample &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;~/Desktop/Eurostat/est.equal.1000iter.sample.rds&quot;</span>) <span class="co"># read in the data</span></span>
<span id="cb3-43"><a href="convergence-behavior-1.html#cb3-43"></a>esample =<span class="st"> </span>esample <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(u.true.y,pop.area.kind.helper)) <span class="co"># take out unused columns</span></span>
<span id="cb3-44"><a href="convergence-behavior-1.html#cb3-44"></a><span class="co"># Generate column names through the use of for loops</span></span>
<span id="cb3-45"><a href="convergence-behavior-1.html#cb3-45"></a>niters =<span class="st"> </span><span class="kw">c</span>() </span>
<span id="cb3-46"><a href="convergence-behavior-1.html#cb3-46"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span><span class="dv">9</span>) {</span>
<span id="cb3-47"><a href="convergence-behavior-1.html#cb3-47"></a>  niters =<span class="st"> </span><span class="kw">c</span>(niters, <span class="kw">paste</span>(<span class="st">&quot;u000&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-48"><a href="convergence-behavior-1.html#cb3-48"></a>}</span>
<span id="cb3-49"><a href="convergence-behavior-1.html#cb3-49"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">10</span><span class="op">:</span><span class="dv">99</span>) {</span>
<span id="cb3-50"><a href="convergence-behavior-1.html#cb3-50"></a>  niters =<span class="st"> </span><span class="kw">c</span>(niters, <span class="kw">paste</span>(<span class="st">&quot;u00&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-51"><a href="convergence-behavior-1.html#cb3-51"></a>}</span>
<span id="cb3-52"><a href="convergence-behavior-1.html#cb3-52"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">100</span><span class="op">:</span><span class="dv">400</span>) {</span>
<span id="cb3-53"><a href="convergence-behavior-1.html#cb3-53"></a>  niters =<span class="st"> </span><span class="kw">c</span>(niters, <span class="kw">paste</span>(<span class="st">&quot;u0&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-54"><a href="convergence-behavior-1.html#cb3-54"></a>}</span>
<span id="cb3-55"><a href="convergence-behavior-1.html#cb3-55"></a><span class="kw">colnames</span>(esample)[<span class="dv">2</span><span class="op">:</span><span class="dv">402</span>] =<span class="st"> </span>niters</span>
<span id="cb3-56"><a href="convergence-behavior-1.html#cb3-56"></a>niters2 =<span class="st"> </span><span class="kw">c</span>()</span>
<span id="cb3-57"><a href="convergence-behavior-1.html#cb3-57"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">401</span><span class="op">:</span><span class="dv">999</span>) {</span>
<span id="cb3-58"><a href="convergence-behavior-1.html#cb3-58"></a>  niters2 =<span class="st"> </span><span class="kw">c</span>(niters2, <span class="kw">paste</span>(<span class="st">&quot;u0&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-59"><a href="convergence-behavior-1.html#cb3-59"></a>}</span>
<span id="cb3-60"><a href="convergence-behavior-1.html#cb3-60"></a><span class="cf">for</span> (x <span class="cf">in</span> <span class="dv">1000</span><span class="op">:</span><span class="dv">1002</span>){</span>
<span id="cb3-61"><a href="convergence-behavior-1.html#cb3-61"></a>  niters2 =<span class="st"> </span><span class="kw">c</span>(niters2, <span class="kw">paste</span>(<span class="st">&quot;u&quot;</span>,x,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))</span>
<span id="cb3-62"><a href="convergence-behavior-1.html#cb3-62"></a>}</span>
<span id="cb3-63"><a href="convergence-behavior-1.html#cb3-63"></a><span class="kw">colnames</span>(esample)[<span class="dv">406</span><span class="op">:</span><span class="dv">1007</span>] =<span class="st"> </span>niters2</span>
<span id="cb3-64"><a href="convergence-behavior-1.html#cb3-64"></a><span class="co"># Calculate the residuals and transform the data frame into the long format.</span></span>
<span id="cb3-65"><a href="convergence-behavior-1.html#cb3-65"></a>equalr =<span class="st"> </span>esample <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb3-66"><a href="convergence-behavior-1.html#cb3-66"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r0001 =</span> u.true <span class="op">-</span><span class="st"> </span>u0001, <span class="dt">r0002 =</span> u.true <span class="op">-</span><span class="st"> </span>u0002, <span class="dt">r0005 =</span> u.true <span class="op">-</span><span class="st"> </span>u0005,</span>
<span id="cb3-67"><a href="convergence-behavior-1.html#cb3-67"></a>         <span class="dt">r0010 =</span> u.true <span class="op">-</span><span class="st"> </span>u0010, <span class="dt">r0020 =</span> u.true <span class="op">-</span><span class="st"> </span>u0020, <span class="dt">r0050 =</span> u.true <span class="op">-</span><span class="st"> </span>u0050,</span>
<span id="cb3-68"><a href="convergence-behavior-1.html#cb3-68"></a>         <span class="dt">r0100 =</span> u.true <span class="op">-</span><span class="st"> </span>u0100, <span class="dt">r0200 =</span> u.true <span class="op">-</span><span class="st"> </span>u0200, <span class="dt">r0300 =</span> u.true <span class="op">-</span><span class="st"> </span>u0300,</span>
<span id="cb3-69"><a href="convergence-behavior-1.html#cb3-69"></a>         <span class="dt">r0400 =</span> u.true <span class="op">-</span><span class="st"> </span>u0400, <span class="dt">r0500 =</span> u.true <span class="op">-</span><span class="st"> </span>u0500, <span class="dt">r0600 =</span> u.true <span class="op">-</span><span class="st"> </span>u0600,</span>
<span id="cb3-70"><a href="convergence-behavior-1.html#cb3-70"></a>         <span class="dt">r0700 =</span> u.true <span class="op">-</span><span class="st"> </span>u0700, <span class="dt">r0800 =</span> u.true <span class="op">-</span><span class="st"> </span>u0800, <span class="dt">r0900 =</span> u.true <span class="op">-</span><span class="st"> </span>u0900,</span>
<span id="cb3-71"><a href="convergence-behavior-1.html#cb3-71"></a>         <span class="dt">r1000 =</span> u.true <span class="op">-</span><span class="st"> </span>u1000</span>
<span id="cb3-72"><a href="convergence-behavior-1.html#cb3-72"></a>         ) <span class="op">%&gt;%</span></span>
<span id="cb3-73"><a href="convergence-behavior-1.html#cb3-73"></a><span class="st">  </span><span class="kw">select</span>(pop.area.kind,internal.id,r0001,r0002,r0005,r0010,r0020,r0050,r0100,r0200,r0300,r0400,r0500,r0600,r0700,r0800,r0900,r1000) <span class="op">%&gt;%</span></span>
<span id="cb3-74"><a href="convergence-behavior-1.html#cb3-74"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(internal.id, pop.area.kind), <span class="dt">names_to =</span> <span class="st">&quot;iter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;resid&quot;</span>)</span>
<span id="cb3-75"><a href="convergence-behavior-1.html#cb3-75"></a><span class="co"># Plot using ggplot  </span></span>
<span id="cb3-76"><a href="convergence-behavior-1.html#cb3-76"></a>equal.resid.plot =<span class="st"> </span>equalr <span class="op">%&gt;%</span></span>
<span id="cb3-77"><a href="convergence-behavior-1.html#cb3-77"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> iter, <span class="dt">y =</span> resid, <span class="dt">group =</span> internal.id)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-78"><a href="convergence-behavior-1.html#cb3-78"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> pop.area.kind)) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of Iteration&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Residual = Actual - Predicted&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Equal Probability Matrix ~ Residual&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_color_ptol</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;Suburban&quot;</span>, <span class="st">&quot;Urban&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb3-79"><a href="convergence-behavior-1.html#cb3-79"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(pop.area.kind),<span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) </span>
<span id="cb3-80"><a href="convergence-behavior-1.html#cb3-80"></a><span class="kw">saveRDS</span>(equal.resid.plot, <span class="dt">file =</span> <span class="st">&quot;equal.resid.plot.rds&quot;</span>) <span class="co"># save the plot as ggplot. </span></span></code></pre></div>
<div class="figure">
<img src="bookdown_files/figure-html/distributionl%20eval%201-1.png" alt="The left and right plots show a stratified sample (strata: area kind) and the tile specific estimatands' convergence behaviour. The convergence behaviour differs between area kinds. The right plot emphasizes that the true value is not necessarily reached." width="672" />
<p class="caption">
(#fig:distributionl eval 1)The left and right plots show a stratified sample (strata: area kind) and the tile specific estimatands’ convergence behaviour. The convergence behaviour differs between area kinds. The right plot emphasizes that the true value is not necessarily reached.
</p>
</div>
<p>The graphs above shows how the estimated population evolve over time (left) as well as its prediction error (right). From the graph on the left, most of the estimated population stabilizes rather quickly in rural and suburban tiles. With the urban tiles, it is harder to say exactly when the convergence will occur, especially there are a bit of variation. The residual plot (right) shows the error of prediction in comparison to the actual population in that specific tile. The rural tiles shows a trend of constant error of prediction over iterations. The suburban tiles generally shows the same trend as well, but also shows that there are tiles that overestimated. The urban tiles tend to have an underestimation.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="convergence-behavior-1.html#cb4-1"></a>tsample &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;~/Desktop/Eurostat/est.true.1000iter.sample.rds&quot;</span>) <span class="co"># read in data</span></span>
<span id="cb4-2"><a href="convergence-behavior-1.html#cb4-2"></a>tsample<span class="op">$</span>internal.id =<span class="st"> </span><span class="kw">as.factor</span>(tsample<span class="op">$</span>internal.id) <span class="co"># cast the `internal id` variable as a factor</span></span>
<span id="cb4-3"><a href="convergence-behavior-1.html#cb4-3"></a><span class="kw">colnames</span>(tsample)</span>
<span id="cb4-4"><a href="convergence-behavior-1.html#cb4-4"></a><span class="kw">colnames</span>(tsample)[<span class="dv">2</span><span class="op">:</span><span class="dv">402</span>] =<span class="st"> </span>iters <span class="co"># reuse the column names generated above</span></span>
<span id="cb4-5"><a href="convergence-behavior-1.html#cb4-5"></a><span class="kw">colnames</span>(tsample)[<span class="dv">405</span><span class="op">:</span><span class="dv">1006</span>] =<span class="st"> </span>iters2</span>
<span id="cb4-6"><a href="convergence-behavior-1.html#cb4-6"></a>tequal =<span class="st"> </span>tsample <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># transform the data frame into long form</span></span>
<span id="cb4-7"><a href="convergence-behavior-1.html#cb4-7"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(internal.id, pop.area.kind,pop), <span class="dt">names_to =</span> <span class="st">&quot;iter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;sim&quot;</span>) </span>
<span id="cb4-8"><a href="convergence-behavior-1.html#cb4-8"></a>tequal<span class="op">$</span>iter =<span class="st"> </span><span class="kw">as.numeric</span>(tequal<span class="op">$</span>iter) <span class="co"># cast the `iter` variable as a numeric variable</span></span>
<span id="cb4-9"><a href="convergence-behavior-1.html#cb4-9"></a><span class="co"># Estimated Population over Iterations plot using ggplot</span></span>
<span id="cb4-10"><a href="convergence-behavior-1.html#cb4-10"></a>true.plot =<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> tequal, <span class="kw">aes</span>(<span class="dt">x =</span> iter, <span class="dt">y =</span> sim, <span class="dt">group =</span> internal.id)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-11"><a href="convergence-behavior-1.html#cb4-11"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> pop.area.kind)) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of Iteration&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Estimated Population&quot;</span>,     <span class="dt">title =</span> <span class="st">&quot;True Population Matrix&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-12"><a href="convergence-behavior-1.html#cb4-12"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span></span>
<span id="cb4-13"><a href="convergence-behavior-1.html#cb4-13"></a><span class="st">  </span><span class="kw">scale_color_ptol</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;Suburban&quot;</span>, <span class="st">&quot;Urban&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-14"><a href="convergence-behavior-1.html#cb4-14"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(pop.area.kind), <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb4-15"><a href="convergence-behavior-1.html#cb4-15"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">50</span>))</span>
<span id="cb4-16"><a href="convergence-behavior-1.html#cb4-16"></a><span class="kw">saveRDS</span>(true.plot, <span class="dt">file =</span> <span class="st">&quot;true.plot.rds&quot;</span>) <span class="co"># save the plot as rds</span></span>
<span id="cb4-17"><a href="convergence-behavior-1.html#cb4-17"></a><span class="co"># Residual Plot</span></span>
<span id="cb4-18"><a href="convergence-behavior-1.html#cb4-18"></a><span class="kw">colnames</span>(tsample)[<span class="dv">2</span><span class="op">:</span><span class="dv">402</span>] =<span class="st"> </span>niters <span class="co"># reused column names from above</span></span>
<span id="cb4-19"><a href="convergence-behavior-1.html#cb4-19"></a><span class="kw">colnames</span>(tsample)[<span class="dv">405</span><span class="op">:</span><span class="dv">1006</span>] =<span class="st"> </span>niters2</span>
<span id="cb4-20"><a href="convergence-behavior-1.html#cb4-20"></a><span class="co"># Calculate the residuals and transform the data frame into the long format.</span></span>
<span id="cb4-21"><a href="convergence-behavior-1.html#cb4-21"></a>tequalr =<span class="st"> </span>tsample <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-22"><a href="convergence-behavior-1.html#cb4-22"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r001 =</span> pop <span class="op">-</span><span class="st"> </span>u0001, <span class="dt">r002 =</span> pop <span class="op">-</span><span class="st"> </span>u0002, <span class="dt">r005 =</span> pop <span class="op">-</span><span class="st"> </span>u0005,</span>
<span id="cb4-23"><a href="convergence-behavior-1.html#cb4-23"></a>         <span class="dt">r010 =</span> pop <span class="op">-</span><span class="st"> </span>u0010, <span class="dt">r020 =</span> pop <span class="op">-</span><span class="st"> </span>u0020, <span class="dt">r050 =</span> pop <span class="op">-</span><span class="st"> </span>u0050,</span>
<span id="cb4-24"><a href="convergence-behavior-1.html#cb4-24"></a>         <span class="dt">r100 =</span> pop <span class="op">-</span><span class="st"> </span>u0100, <span class="dt">r200 =</span> pop <span class="op">-</span><span class="st"> </span>u0200, <span class="dt">r300 =</span> pop <span class="op">-</span><span class="st"> </span>u0300,</span>
<span id="cb4-25"><a href="convergence-behavior-1.html#cb4-25"></a>         <span class="dt">r400 =</span> pop <span class="op">-</span><span class="st"> </span>u0400, <span class="dt">r500 =</span> pop <span class="op">-</span><span class="st"> </span>u0500, <span class="dt">r600 =</span> pop <span class="op">-</span><span class="st"> </span>u0600,</span>
<span id="cb4-26"><a href="convergence-behavior-1.html#cb4-26"></a>         <span class="dt">r700 =</span> pop <span class="op">-</span><span class="st"> </span>u0700, <span class="dt">r800 =</span> pop <span class="op">-</span><span class="st"> </span>u0800, <span class="dt">r900 =</span> pop <span class="op">-</span><span class="st"> </span>u0900,</span>
<span id="cb4-27"><a href="convergence-behavior-1.html#cb4-27"></a>         <span class="dt">r1000 =</span> pop <span class="op">-</span><span class="st"> </span>u1000</span>
<span id="cb4-28"><a href="convergence-behavior-1.html#cb4-28"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb4-29"><a href="convergence-behavior-1.html#cb4-29"></a><span class="st">  </span><span class="kw">select</span>(pop.area.kind,internal.id,r001,r002,r005,r010,r020,r050,r100,r200,r300,r400,r500,r600,r700,r800) <span class="op">%&gt;%</span></span>
<span id="cb4-30"><a href="convergence-behavior-1.html#cb4-30"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span><span class="kw">c</span>(internal.id, pop.area.kind), <span class="dt">names_to =</span> <span class="st">&quot;iter&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;resid&quot;</span>)</span>
<span id="cb4-31"><a href="convergence-behavior-1.html#cb4-31"></a><span class="co"># Plot using ggplot</span></span>
<span id="cb4-32"><a href="convergence-behavior-1.html#cb4-32"></a>true.resid.plot =<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> tequalr, <span class="kw">aes</span>(<span class="dt">x =</span> iter, <span class="dt">y =</span> resid, <span class="dt">group =</span> internal.id)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-33"><a href="convergence-behavior-1.html#cb4-33"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> pop.area.kind)) <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of Iteration&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Residual = Actual - Predicted&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;True Population Matrix ~ Residual&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-34"><a href="convergence-behavior-1.html#cb4-34"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>),<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-35"><a href="convergence-behavior-1.html#cb4-35"></a><span class="st">  </span><span class="kw">scale_color_ptol</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;Rural&quot;</span>, <span class="st">&quot;Suburban&quot;</span>, <span class="st">&quot;Urban&quot;</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb4-36"><a href="convergence-behavior-1.html#cb4-36"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="kw">vars</span>(pop.area.kind),<span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) </span>
<span id="cb4-37"><a href="convergence-behavior-1.html#cb4-37"></a><span class="kw">saveRDS</span>(true.resid.plot, <span class="dt">file =</span> <span class="st">&quot;true.resid.plot.rds&quot;</span>) <span class="co"># save ggplot as rds format</span></span></code></pre></div>
<div class="figure">
<img src="bookdown_files/figure-html/distributionl%20eval%202-1.png" alt="The left and right plots show a stratified sample (strata: area kind) and the tile specific estimatands' convergence behaviour (equal probability P.matrix). The convergence behaviour differs between area kinds. The right plot emphasizes that the true value is not necessarily reached." width="672" />
<p class="caption">
(#fig:distributionl eval 2)The left and right plots show a stratified sample (strata: area kind) and the tile specific estimatands’ convergence behaviour (equal probability P.matrix). The convergence behaviour differs between area kinds. The right plot emphasizes that the true value is not necessarily reached.
</p>
</div>
<p>Using the true population matrix, the estimated population stabilizes faster over time in comparison to the equal population matrix. However, there are a few tiles that do not stabilize as fast as we hoped. This is particularly evident in the urban tiles. The residual plot (right) shows the error of prediction over time by the type of tile. There seems to be a trend of increasing prediction error as the degree of urbanization increases as well. We can see that the range of error for suburban tiles range from 30 to -10 and the range of error for urban tiles are between 100 and -75. The suburban tiles seems to underestimate and the urban tiles seems to overestimate.</p>

</div>
<!-- </div> -->
            </section>

          </div>
        </div>
      </div>
<a href="discrepancy-measures-per-iteration-1.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true,
"info": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
